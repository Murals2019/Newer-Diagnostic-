<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Deep Diagnostic Reporter</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.17/marked.min.js"></script>

<style>
body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
.diagnosis-card { box-shadow: 0 0 40px rgba(79, 70, 229, 0.15); transition: transform 0.3s ease-in-out; }
.diagnosis-card:hover { transform: translateY(-2px); }
.header-bg { background-image: linear-gradient(135deg, #4f46e5 0%, #a5b4fc 100%); color: white; }
.processing { cursor: not-allowed; background-color: #9ca3af; transform: scale(1); }
.report-content { background-color: #fff; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); }
</style>
</head>
<body class="p-4 md:p-8 min-h-screen">

<div class="max-w-6xl mx-auto">

  <!-- Header -->
  <header class="header-bg p-6 rounded-t-xl mb-8 diagnosis-card">
    <h1 class="text-4xl font-extrabold text-center mb-1">AI Deep Diagnostic Reporter</h1>
    <p class="text-lg text-center text-indigo-200">Intelligent Analysis & Structured Reporting</p>
  </header>

  <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- Left Column -->
    <div class="lg:col-span-1 space-y-6">
      <div class="bg-white p-6 rounded-xl diagnosis-card">
        <h2 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2 text-indigo-700">Overview</h2>
        <p class="text-gray-600 text-sm leading-relaxed">
          AI separates **Symptomatic/Objective Data** from **Environmental/Contextual Data**, performs a detailed two-stage analysis, generates differential diagnoses, assigns confidence levels, and produces actionable recommendations.
        </p>
      </div>
    </div>

    <!-- Right Column -->
    <div class="lg:col-span-2 space-y-6">

      <!-- Input -->
      <div class="bg-white p-6 rounded-xl diagnosis-card">
        <label for="unifiedInput" class="block text-xl font-semibold text-gray-700 mb-3 text-indigo-700">
          Enter Dataset (Medical Charts, Logs, Observations, etc.)
        </label>
        <textarea id="unifiedInput" rows="10" placeholder="Paste your data here..." class="w-full p-4 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-gray-800 resize-none"></textarea>
        <div class="mt-6 flex flex-col items-center">
          <button id="diagnoseButton" onclick="analyzeWithAI()" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 ease-in-out">
            Generate Deep Report
          </button>
          <div id="loadingIndicator" class="hidden mt-4 flex items-center justify-center space-x-2 text-indigo-600 font-medium">
            <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Processing Deep Analysis...</span>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div id="results" class="mt-10 min-h-[300px]">
        <div class="text-center text-gray-500 italic p-6 border-2 border-dashed border-indigo-200 rounded-xl bg-white">
          <p class="mt-2 text-lg font-medium">Report Ready</p>
          <p class="text-sm">Your deep analysis will appear here after processing.</p>
        </div>
      </div>

    </div>
  </main>
</div>

<script>
async function analyzeWithAI() {
  const input = document.getElementById('unifiedInput').value.trim();
  const btn = document.getElementById('diagnoseButton');
  const results = document.getElementById('results');

  if (!input) {
    results.innerHTML = '<p class="text-red-600">Please enter data for analysis.</p>';
    return;
  }

  btn.disabled = true;
  btn.textContent = "Analyzing...";
  document.getElementById('loadingIndicator').classList.remove('hidden');

  try {
    const res = await fetch("/.netlify/functions/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data: input })
    });

    const json = await res.json();
    results.innerHTML = `<div class="report-content prose max-w-none p-6">${marked.parse(json.report)}</div>`;
    results.scrollIntoView({ behavior: "smooth" });

  } catch (err) {
    console.error(err);
    results.innerHTML = '<p class="text-red-600">Error: Unable to analyze data.</p>';
  } finally {
    btn.disabled = false;
    btn.textContent = "Generate Deep Report";
    document.getElementById('loadingIndicator').classList.add('hidden');
  }
}
</script>
</body>
</html>
